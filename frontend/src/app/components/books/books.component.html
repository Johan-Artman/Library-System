<div class="books-container">
  <h2>Library Books</h2>
  
  <!-- Search Section -->
  <div class="search-section">
    <div class="search-bar">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Search books by title..." 
        [(ngModel)]="searchQuery"
        (keyup.enter)="searchBooks()"
        (input)="searchQuery.length === 0 ? clearSearch() : null">
      <button class="btn btn-search" (click)="searchBooks()" [disabled]="isSearching">
        <span *ngIf="!isSearching">üîç</span>
        <span *ngIf="isSearching">‚è≥</span>
      </button>
      <button class="btn btn-clear" (click)="clearSearch()" *ngIf="searchQuery.length > 0">
        ‚úï
      </button>
    </div>
    <p class="search-results" *ngIf="searchQuery.length > 0">
      {{ filteredBooks.length }} result(s) for "{{ searchQuery }}"
    </p>
  </div>
  
  <!-- Actions (Only for Librarians) -->
  <div class="actions" *ngIf="isLibrarian">
    <button class="btn btn-primary" (click)="toggleAddForm()">
      {{ showAddForm ? 'Cancel' : 'Add New Book' }}
    </button>
    <button class="btn btn-secondary" (click)="toggleLocationView()">
      {{ showLocation ? 'Hide Location' : 'Show All Locations' }}
    </button>
  </div>

  <!-- Actions for Lenders -->
  <div class="actions" *ngIf="!isLibrarian">
    <button class="btn btn-secondary" (click)="toggleLocationView()">
      {{ showLocation ? 'Hide Location' : 'Show Library Map' }}
    </button>
  </div>

  <!-- Add Book Form (Only for Librarians) -->
  <div class="add-book-form" *ngIf="showAddForm && isLibrarian">
    <h3>Add New Book</h3>
    <form (ngSubmit)="addBook()" #addForm="ngForm">
      <div class="form-group">
        <label for="isbn">ISBN:</label>
        <input type="number" id="isbn" name="isbn" [(ngModel)]="newBook.isbn" required>
      </div>
      <div class="form-group">
        <label for="title">Title:</label>
        <input type="text" id="title" name="title" [(ngModel)]="newBook.title" required>
      </div>
      <div class="form-group">
        <label for="availableCopies">Available Copies:</label>
        <input type="number" id="availableCopies" name="availableCopies" [(ngModel)]="newBook.availableCopies" required min="0">
      </div>
      <div class="form-actions">
        <button type="submit" class="btn btn-success" [disabled]="!addForm.valid">Add Book</button>
        <button type="button" class="btn btn-secondary" (click)="toggleAddForm()">Cancel</button>
      </div>
    </form>
  </div>

  <!-- Books List -->
  <div class="books-list">
    <table class="books-table">
      <thead>
        <tr>
          <th>ISBN</th>
          <th>Title</th>
          <th>Available Copies</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let book of filteredBooks">
          <td>{{ book.isbn }}</td>
          <td>{{ book.title }}</td>
          <td>{{ book.availableCopies }}</td>
          <td class="actions-cell">
            <button class="btn btn-sm btn-location" (click)="showBookLocation(book)">üìç Location</button>
            <button class="btn btn-sm btn-info" (click)="selectBook(book)" *ngIf="isLibrarian">Edit</button>
            <button class="btn btn-sm btn-danger" (click)="deleteBook(book.isbn)" *ngIf="isLibrarian">Delete</button>
          </td>
        </tr>
        <tr *ngIf="filteredBooks.length === 0">
          <td [attr.colspan]="4" class="no-results">
            {{ searchQuery ? 'No books found matching your search.' : 'No books available.' }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Edit Book Form (Only for Librarians) -->
  <div class="edit-book-form" *ngIf="selectedBook && isLibrarian">
    <h3>Edit Book</h3>
    <form (ngSubmit)="updateBook()" #editForm="ngForm">
      <div class="form-group">
        <label for="editIsbn">ISBN:</label>
        <input type="number" id="editIsbn" name="editIsbn" [(ngModel)]="selectedBook.isbn" required readonly>
      </div>
      <div class="form-group">
        <label for="editTitle">Title:</label>
        <input type="text" id="editTitle" name="editTitle" [(ngModel)]="selectedBook.title" required>
      </div>
      <div class="form-group">
        <label for="editAvailableCopies">Available Copies:</label>
        <input type="number" id="editAvailableCopies" name="editAvailableCopies" [(ngModel)]="selectedBook.availableCopies" required min="0">
      </div>
      <div class="form-actions">
        <button type="submit" class="btn btn-success" [disabled]="!editForm.valid">Update Book</button>
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
      </div>
    </form>
  </div>

  <!-- Library Map -->
  <app-library-map 
    *ngIf="showLocation"
    [selectedBookIsbn]="selectedBook?.isbn"
    [showAllBooks]="!selectedBook">
  </app-library-map>
</div>